(function(){var t,n={}.hasOwnProperty,s=function(t,s){function e(){this.constructor=t}for(var r in s)n.call(s,r)&&(t[r]=s[r]);return e.prototype=s.prototype,t.prototype=new e,t.__super__=s.prototype,t},e=function(t,n){return function(){return t.apply(n,arguments)}};t={},t.version="1.1.0",t.Steps=function(){function t(){this.storage=[]}return t.prototype.add=function(t){if(this.find(t.name))throw{name:"Exception",message:'Step with name "'+t.name+'" is already in the collection'};return this.storage.push(t)},t.prototype.find=function(t){return this.storage.filter(function(n){return n.name===t})[0]},t.prototype.first=function(t){return null!=t&&(this.first_step=t),this.first_step},t.prototype.length=function(){return this.storage.length},t}(),t.Step=function(){function t(t,n,s){this.name=t,this.next={},this.next.success=n,this.next.failure=s,this.collaborators=[]}return t.prototype.attach_collaborator=function(t){return this.collaborators.push(t)},t.prototype.start=function(){var t,n=this;return t=this.collaborators.map(function(t){var n;return n=new $.Deferred,t(n),n}),$.when.apply(null,t).done(function(){return n._success()}).fail(function(){return n._fail()})},t.prototype._fail=function(){return this.next.failure.start()},t.prototype._success=function(){return this.next.success.start()},t}(),t.NullStep=function(){function t(){}return t.prototype.start=function(){},t}(),t.InputStep=function(){function t(t){this.name=t,this.transitions={}}return t.prototype.process=function(t){return t(this,this.transitions.success,this.transitions.failure)},t}(),t.NullInputStep=function(n){function e(){e.__super__.constructor.call(this,"NullInputStep")}return s(e,n),e.prototype.process=function(){return new t.NullStep},e}(t.InputStep),t.InputTransform=function(){function n(){}var s;return s=new t.NullInputStep,n.prototype.process=function(t){return null==t?s:"string"==typeof t?this.process_string(t):t instanceof Array?this.process_array(t):t instanceof Object?this.process_object(t):void 0},n.prototype.process_string=function(n){var e;return e=new t.InputStep(n),e.transitions.success=s,e.transitions.failure=s,e},n.prototype.process_object=function(n){var s,e,r,o;if(e=Object.keys(n),e.length>1)throw{message:"Object can have just one key"};return r=new t.InputStep(e[0]),"object"==typeof n[r.name]?(o=n[r.name].success,s=n[r.name].failure):(o=n[r.name],s=void 0),r.transitions.success=this.process(o),r.transitions.failure=this.process(s),r},n.prototype.process_array=function(t){var n,e;return 0===t.length?s:(e=t.shift(),"string"==typeof e?(n=this.process(e),n.transitions.success=this.process_array(t)):n=this.process(e),n)},n}(),t.Builder=function(){function s(){this._build=e(this._build,this)}return s.prototype.process=function(s){var e,r,o,i,u;this.transformer=new t.InputTransform,this._tmp_steps={},e=this.transformer.process(s),e.process(this._build),o=new t.Steps,u=this._tmp_steps;for(r in u)n.call(u,r)&&(i=u[r],o.add(i));return o.first(o.find(e.name)),o},s.prototype._build=function(n,s,e){return null!=this._tmp_steps[n.name]?this._tmp_steps[n.name]:(this._tmp_steps[n.name]=new t.Step(n.name,void 0,void 0),this._tmp_steps[n.name].next.success=s.process(this._build),this._tmp_steps[n.name].next.failure=e.process(this._build),this._tmp_steps[n.name])},s}(),t.Machine=function(){function n(n){var s;s=new t.Builder,this.steps=s.process(n)}return n.prototype.join=function(t,n){return t=this.steps.find(t),t.attach_collaborator(n)},n.prototype.init=function(){return this.steps.first().start()},n}(),window.Frundis=t}).call(this);